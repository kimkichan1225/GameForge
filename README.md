# GameForge - 3D FPS/TPS 게임

React Three Fiber 기반의 3D 슈팅 게임 프로젝트입니다.

## 기술 스택

- **React 18** + **TypeScript**
- **Three.js** / **React Three Fiber** - 3D 렌더링
- **Zustand** - 상태 관리
- **Vite** - 빌드 도구

## 주요 기능

### 캐릭터 시스템
- **1인칭 / 3인칭 시점 전환**
- **자세 변경**: 서기, 앉기(C), 엎드리기(Z)
- **이동**: WASD 이동, Shift 달리기
- **점프**: Space

### 조준 시스템
- **토글 조준**: 우클릭 짧게 → 조준 상태 유지 (달리기/점프 시 자동 해제)
- **홀드 조준**: 우클릭 길게 누르기 → 누르는 동안만 조준
- **3인칭 토글 조준**: 3인칭에서 토글 조준 시 1인칭 시야로 전환
- **시점별 독립 오프셋**: 1인칭/3인칭 각각 다른 카메라 설정

### 무기 시스템
- **무기 종류**: 라이플, 샷건, 스나이퍼
- **무기별 발사 속도**: 라이플(20발/초), 샷건(2발/초), 스나이퍼(1발/초)
- **총 반동 효과**: 토글 조준 시 발사 반동 적용
- **총구 플래시**: PointLight + Sprite 기반 시각 효과

### 발사 이펙트 시스템
- **투사체 시스템**: 실제 총알이 총구에서 발사되어 비행
- **충돌 감지**: 총알 비행 중 실시간 레이캐스트 충돌 감지
- **히트 스파크**: 충돌 지점에 파티클 이펙트
- **탄흔 데칼**: 충돌 표면에 탄흔 텍스처 (8초 후 페이드 아웃)
- **조준점 보정**: 크로스헤어(+) 위치로 정확히 발사

### 카메라 시스템
- **3인칭 팔로우 카메라**: 캐릭터 뒤에서 부드럽게 따라감
- **3인칭 자유 카메라**: 마우스 휠로 거리 조절
- **1인칭 카메라**: 캐릭터 눈 높이에서 시점
- **자세별 카메라 높이**: 서기/앉기/엎드리기 각각 다른 눈 높이
- **이동 방향 보정**: 크로스헤어 방향으로 WASD 이동

### 성능 최적화
- **오브젝트 풀링**: 총알(20), 탄흔(50), 스파크(30) 재사용
- **GC 방지**: 재사용 가능한 THREE.js 객체 (Vector3, Quaternion 등)
- **삼각함수 캐싱**: 동일 angle에 대한 sin/cos 재계산 방지
- **레이캐스트 타겟 캐싱**: 500ms 간격으로 씬 순회
- **조건부 업데이트**: 활성 객체가 없을 때 로직 스킵

## 조작법

| 키 | 동작 |
|---|---|
| W/A/S/D | 이동 |
| Shift | 달리기 |
| Space | 점프 |
| C | 앉기/서기 |
| Z | 엎드리기/서기 |
| 좌클릭 | 발사 |
| 우클릭 (짧게) | 토글 조준 |
| 우클릭 (길게) | 홀드 조준 |
| 마우스 휠 | 카메라 거리 조절 (자유 모드) |

## 프로젝트 구조

```
src/
├── components/
│   ├── Camera.tsx          # 카메라 컨트롤
│   ├── GunPlayer.tsx       # 플레이어 캐릭터 및 무기
│   ├── Ground.tsx          # 지형
│   └── effects/
│       ├── BulletEffects.tsx   # 이펙트 매니저
│       ├── TracerLine.tsx      # 총알 투사체
│       ├── BulletDecal.tsx     # 탄흔 데칼
│       └── HitSpark.tsx        # 히트 스파크 파티클
├── hooks/
│   └── useInput.ts         # 키보드 입력 훅
├── store/
│   └── gameStore.ts        # Zustand 상태 관리
└── App.tsx                 # 메인 앱
```

## 실행 방법

```bash
# 의존성 설치
npm install

# 개발 서버 실행
npm run dev

# 프로덕션 빌드
npm run build
```

## 개발 일지

### 2026-02-05 - 총게임 모드 개발

#### 조준 시스템
- 1인칭 토글/홀드 조준 분리 구현
- 토글 조준: 우클릭 짧게 → 조준 상태 유지
- 홀드 조준: 우클릭 길게 → 누르는 동안만 조준
- Run/점프 상태에서 조준 자동 해제
- 3인칭 토글 조준 시 1인칭 시야 전환 기능
- 1인칭/3인칭 토글 조준 카메라 오프셋 분리

#### 무기 시스템
- 멀티플레이어 대응: 1인칭/3인칭용 무기 모델 분리
- 토글 조준 시 총 반동 효과 추가
- 총구 플래시 스프라이트 추가 (PointLight + Sprite)
- 자세별 풀암 모델 위치 및 카메라 높이 부드러운 전환

#### 발사 이펙트 시스템
- 발사 레이캐스트 시스템 구현
  - 히트 스파크: Points 기반 파티클 (풀 30개, 수명 0.15초)
  - 탄흔 데칼: InstancedMesh 기반 (풀 50개, 수명 8초)
  - 트레이서: 원기둥 총알 투사체 (풀 20개)
- 투사체 기반 충돌 감지 (비행 중 실시간 레이캐스트)
- 총알 발사 위치를 실제 총구로 변경
- 조준점 보정: 크로스헤어 방향으로 정확히 발사

#### 카메라 시스템
- 3인칭 홀드 조준 시 카메라 오프셋 조절
- 3인칭 토글 조준 시 바라보는 지점 오프셋 분리
- 3인칭 모드 이동 방향을 크로스헤어(+) 기준으로 보정

#### 성능 최적화
- 총알 이펙트 시스템 최적화
  - 레이캐스트 타겟 캐싱 (500ms 간격)
  - 활성 상태 플래그로 불필요한 업데이트 스킵
  - GC 방지용 정적 재사용 객체
- Camera 및 GunPlayer 최적화
  - 삼각함수 계산 캐싱 (angle 기반)
  - 매 프레임 객체 생성 제거 (.clone() → 재사용 객체)

## 라이선스

MIT License
